<span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">interface</span><span class="tok-identifier" style="color: #24292e">Token</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">interface</span><span class="tok-identifier" style="color: #24292e">ThemeStyle</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">?</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-identifier" style="color: #24292e">hex</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">or</span><span class="tok-identifier" style="color: #24292e">ansi</span><span class="tok-identifier" style="color: #24292e">name</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">we</span><span class="tok-string" style="color: #032f62">&#39;ll map)
  fontStyle?: &#39;</span><span class="tok-identifier" style="color: #24292e">bold</span><span class="tok-string" style="color: #032f62">&#39; | &#39;</span><span class="tok-identifier" style="color: #24292e">italic</span><span class="tok-string" style="color: #032f62">&#39; | &#39;</span><span class="tok-identifier" style="color: #24292e">underline</span><span class="tok-string" style="color: #032f62">&#39; | &#39;</span><span class="tok-identifier" style="color: #24292e">dim</span><span class="tok-string" style="color: #032f62">&#39;;
}

export interface ThemeDefinition {
  [tokenType: string]: ThemeStyle;
}

export interface HighlightOptions {
  theme?: ThemeDefinition;
  html?: boolean; // output HTML instead of ANSI if true
  language?: string; // specify the language for tokenization
}

const defaultTheme: ThemeDefinition = {
  keyword: { color: &#39;</span><span class="tok-comment" style="color: #6a737d;font-style:italic">#d73a49&#39;, fontStyle: &#39;bold&#39; },</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;#032f62&#39;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">number</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;#005cc5&#39;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">punctuation</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;#24292e&#39;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">comment</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;#6a737d&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">fontStyle</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;italic&#39;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">identifier</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">color</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-string" style="color: #032f62">&#39;#24292e&#39;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-identifier" style="color: #24292e">Language</span><span class="tok-identifier" style="color: #24292e">registry</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-identifier" style="color: #24292e">Tokenizer</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">code</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-identifier" style="color: #24292e">Token</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">const</span><span class="tok-identifier" style="color: #24292e">languages</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">Map</span><span class="tok-punctuation" style="color: #24292e">&lt;</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">Tokenizer</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-identifier" style="color: #24292e">new</span><span class="tok-identifier" style="color: #24292e">Map</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">function</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">name</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizer</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">Tokenizer</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">languages</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">set</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">name</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">toLowerCase</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizer</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">function</span><span class="tok-identifier" style="color: #24292e">getLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">name</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">Tokenizer</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-identifier" style="color: #24292e">undefined</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-identifier" style="color: #24292e">languages</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">get</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">name</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">toLowerCase</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">function</span><span class="tok-identifier" style="color: #24292e">listLanguages</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">languages</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">keys</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">sort</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-identifier" style="color: #24292e">JavaScript</span><span class="tok-identifier" style="color: #24292e">tokenizer</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">baseline</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-identifier" style="color: #24292e">const</span><span class="tok-identifier" style="color: #24292e">jsKeywordSet</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-identifier" style="color: #24292e">new</span><span class="tok-identifier" style="color: #24292e">Set</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-string" style="color: #032f62">&#39;break&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;case&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;catch&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;class&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;const&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;continue&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;debugger&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;default&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;delete&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;do&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;else&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;export&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;extends&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;finally&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;for&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;function&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;if&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;import&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;in&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;instanceof&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;let&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;new&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;return&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;super&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;switch&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;this&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;throw&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;try&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;typeof&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;var&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;void&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;while&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;with&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;yield&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;enum&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;await&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;implements&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;package&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;protected&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;static&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;interface&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;private&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-string" style="color: #032f62">&#39;public&#39;</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">function</span><span class="tok-identifier" style="color: #24292e">tokenizeJavaScript</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">code</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">Token</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">const</span><span class="tok-identifier" style="color: #24292e">tokens</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">Token</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">const</span><span class="tok-identifier" style="color: #24292e">regex</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-punctuation" style="color: #24292e">*</span><span class="tok-punctuation" style="color: #24292e">?</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">*</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-identifier" style="color: #24292e">s</span><span class="tok-identifier" style="color: #24292e">S</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">*</span><span class="tok-punctuation" style="color: #24292e">?</span><span class="tok-punctuation" style="color: #24292e">*</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-string" style="color: #032f62">&quot;(?:\\.|[^\&quot;\\])*\&quot;|&#39;(?:\\.|[^&#39;\\])*&#39;|`(?:\\.|[^`\\])*`|\b\d+(?:\.\d+)?\b|[A-Za-z_$][A-Za-z0-9_$]*|[{}()[\].,;:+\-*/%&amp;|^!?=&lt;&gt;]/gm;
  let match: RegExpExecArray | null;
  while ((match = regex.exec(code)) !== null) {
    const value = match[0];
    let type: string;
    if (/^\/\//.test(value) || /^\/\*/.test(value)) type = &#39;comment&#39;;
    else if (/^[`&#39;\&quot;]/.test(value)) type = &#39;string&#39;;
    else if (/^\d/.test(value)) type = &#39;number&#39;;
    else if (jsKeywordSet.has(value)) type = &#39;keyword&#39;;
    else if (/^[A-Za-z_$]/.test(value)) type = &#39;identifier&#39;;
    else type = &#39;punctuation&#39;;
    tokens.push({ type, value });
  }
  return tokens;
}

// ANSI helpers
const ansiColors: Record&lt;string, string&gt; = {
  &#39;#d73a49&#39;: &#39;\u001b[31m&#39;,
  &#39;#032f62&#39;: &#39;\u001b[34m&#39;,
  &#39;#005cc5&#39;: &#39;\u001b[36m&#39;,
  &#39;#24292e&#39;: &#39;\u001b[37m&#39;,
  &#39;#6a737d&#39;: &#39;\u001b[90m&#39;
};

function applyAnsi(style: ThemeStyle, text: string): string {
  let out = text;
  if (style.color &amp;&amp; ansiColors[style.color]) out = ansiColors[style.color] + out;
  if (style.fontStyle) {
    const map: Record&lt;string,string&gt; = {
      bold: &#39;\u001b[1m&#39;, italic: &#39;\u001b[3m&#39;, underline: &#39;\u001b[4m&#39;, dim: &#39;\u001b[2m&#39;
    };
    out = map[style.fontStyle] + out;
  }
  return out + &#39;\u001b[0m&#39;;
}
// Python tokenizer (very small subset)
const pyKeywordSet = new Set([&#39;def&#39;,&#39;return&#39;,&#39;if&#39;,&#39;elif&#39;,&#39;else&#39;,&#39;for&#39;,&#39;while&#39;,&#39;import&#39;,&#39;from&#39;,&#39;as&#39;,&#39;class&#39;,&#39;try&#39;,&#39;except&#39;,&#39;finally&#39;,&#39;with&#39;,&#39;yield&#39;,&#39;lambda&#39;,&#39;pass&#39;,&#39;break&#39;,&#39;continue&#39;,&#39;and&#39;,&#39;or&#39;,&#39;not&#39;,&#39;in&#39;,&#39;is&#39;,&#39;None&#39;,&#39;True&#39;,&#39;False&#39;]);
export function tokenizePython(code: string): Token[] {
  const tokens: Token[] = [];
  const regex = /#.*$|&quot;</span><span class="tok-string" style="color: #032f62">&quot;&quot;</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-identifier" style="color: #24292e">s</span><span class="tok-identifier" style="color: #24292e">S</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">*</span><span class="tok-punctuation" style="color: #24292e">?</span><span class="tok-comment" style="color: #6a737d;font-style:italic">&quot;&quot;&quot;|&#39;&#39;&#39;[\s\S]*?&#39;&#39;&#39;|\&quot;(?:\\.|[^\&quot;\\])*\&quot;|&#39;(?:\\.|[^&#39;\\])*&#39;|\b\d+(?:\.\d+)?\b|[A-Za-z_][A-Za-z0-9_]*|[{}()[\].,;:+\-*/%&amp;|^!?=&lt;&gt;]/gm;
  let match: RegExpExecArray | null;
  while ((match = regex.exec(code)) !== null) {
    const value = match[0];
    let type: string;
    if (/^#/.test(value) || /^&quot;&quot;&quot;</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">test</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">^</span><span class="tok-string" style="color: #032f62">&#39;&#39;</span><span class="tok-string" style="color: #032f62">&#39;/.test(value)) type = &#39;</span><span class="tok-identifier" style="color: #24292e">comment</span><span class="tok-string" style="color: #032f62">&#39;;
    else if (/^[&quot;&#39;</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">test</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-string" style="color: #032f62">&#39;string&#39;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">else</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">if</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">^</span><span class="tok-identifier" style="color: #24292e">d</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">test</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-string" style="color: #032f62">&#39;number&#39;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">else</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">if</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">pyKeywordSet</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">has</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-string" style="color: #032f62">&#39;keyword&#39;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">else</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">if</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">^</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-identifier" style="color: #24292e">A</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-identifier" style="color: #24292e">Za</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-identifier" style="color: #24292e">z_</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">test</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-string" style="color: #032f62">&#39;identifier&#39;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">else</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-string" style="color: #032f62">&#39;punctuation&#39;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">tokens</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">push</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-identifier" style="color: #24292e">tokens</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-identifier" style="color: #24292e">Register</span><span class="tok-identifier" style="color: #24292e">built</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-identifier" style="color: #24292e">ins</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;javascript&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizeJavaScript</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;js&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizeJavaScript</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;python&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizePython</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;py&#39;</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizePython</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-identifier" style="color: #24292e">function</span><span class="tok-identifier" style="color: #24292e">escapeHtml</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">str</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">:</span><span class="tok-identifier" style="color: #24292e">string</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-identifier" style="color: #24292e">str</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">replace</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-punctuation" style="color: #24292e">&amp;</span><span class="tok-punctuation" style="color: #24292e">&lt;</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-string" style="color: #032f62">&quot;&#39;]/g, c =&gt; ({&#39;&amp;&#39;:&#39;&amp;amp;&#39;,&#39;&lt;&#39;:&#39;&amp;lt;&#39;,&#39;&gt;&#39;:&#39;&amp;gt;&#39;,&#39;\&quot;&#39;:&#39;&amp;quot;&#39;,&#39;\&#39;&#39;:&#39;&amp;#39;&#39;}[c]!));
}

export function highlight(code: string, options: HighlightOptions = {}): string {
  const theme = { ...defaultTheme, ...(options.theme||{}) };
  const langName = options.language || &#39;javascript&#39;;
  const tokenizer = getLanguage(langName) || tokenizeJavaScript;
  const tokens = tokenizer(code);
  if (options.html) {
    return tokens.map(t =&gt; {
      const style = theme[t.type] || {};
      const css: string[] = [];
      if (style.color) css.push(`color: ${style.color}`);
      if (style.fontStyle === &#39;bold&#39;) css.push(&#39;font-weight:600&#39;);
      if (style.fontStyle === &#39;italic&#39;) css.push(&#39;font-style:italic&#39;);
      if (style.fontStyle === &#39;underline&#39;) css.push(&#39;text-decoration:underline&#39;);
      if (style.fontStyle === &#39;dim&#39;) css.push(&#39;opacity:0.75&#39;);
      return `&lt;span class=&quot;</span><span class="tok-identifier" style="color: #24292e">tok</span><span class="tok-punctuation" style="color: #24292e">-</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">t</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-string" style="color: #032f62">&quot; style=&quot;</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">css</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">join</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;;&#39;</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">escapeHtml</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">t</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">&lt;</span><span class="tok-punctuation" style="color: #24292e">/</span><span class="tok-identifier" style="color: #24292e">span</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">join</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;&#39;</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-identifier" style="color: #24292e">tokens</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">map</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">t</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-punctuation" style="color: #24292e">&gt;</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">const</span><span class="tok-identifier" style="color: #24292e">style</span><span class="tok-punctuation" style="color: #24292e">=</span><span class="tok-identifier" style="color: #24292e">theme</span><span class="tok-punctuation" style="color: #24292e">[</span><span class="tok-identifier" style="color: #24292e">t</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">type</span><span class="tok-punctuation" style="color: #24292e">]</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-punctuation" style="color: #24292e">|</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-keyword" style="color: #d73a49;font-weight:600">return</span><span class="tok-identifier" style="color: #24292e">applyAnsi</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-identifier" style="color: #24292e">style</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">t</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">value</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">.</span><span class="tok-identifier" style="color: #24292e">join</span><span class="tok-punctuation" style="color: #24292e">(</span><span class="tok-string" style="color: #032f62">&#39;&#39;</span><span class="tok-punctuation" style="color: #24292e">)</span><span class="tok-punctuation" style="color: #24292e">;</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-identifier" style="color: #24292e">export</span><span class="tok-identifier" style="color: #24292e">default</span><span class="tok-punctuation" style="color: #24292e">{</span><span class="tok-identifier" style="color: #24292e">highlight</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizeJavaScript</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">tokenizePython</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">registerLanguage</span><span class="tok-punctuation" style="color: #24292e">,</span><span class="tok-identifier" style="color: #24292e">listLanguages</span><span class="tok-punctuation" style="color: #24292e">}</span><span class="tok-punctuation" style="color: #24292e">;</span>